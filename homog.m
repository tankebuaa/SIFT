% ----------------------------homog.m------------------------------
% º∆À„µ•”¶æÿ’Û
% -----------------------

function M = homog(p1, p2, m)

A = zeros(2 * m, 9);
for i = 1:m
   A(2 * i - 1, 4) = -p1(i, 1);
   A(2 * i - 1, 5) = -p1(i, 2);
   A(2 * i - 1, 6) = -1.0;
   A(2 * i - 1, 7) = p2(i, 2) * p1(i, 1);
   A(2 * i - 1, 8) = p2(i, 2) * p1(i, 2);
   A(2 * i - 1, 9) = p2(i, 2);
   A(2 * i, 1) = p1(i, 1);
   A(2 * i, 2) = p1(i, 2);
   A(2 * i, 3) = 1.0;
   A(2 * i, 7) = -p2(i, 1) * p1(i ,1);
   A(2 * i, 8) = -p2(i, 1) * p1(i, 2);
   A(2 * i, 9) = -p2(i, 1);   
end
M = zeros(3,3);
[~,~,H] = svd(A);
h = H(:, 9) / H(9, 9);
for i = 1:3
   for j = 1:3
      M(i, j) = h(3 * i + j -3); 
   end
end

end